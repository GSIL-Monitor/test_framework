{"name": "添加PVG视频服务器成功", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'FAIL' == 'SUCCESS'\n  - FAIL\n  + SUCCESS", "trace": "video_api = <testAPI.interface.mod_2_video.conftest.APIVideo object at 0x000002549F15F748>\npvg_server = 'pvg_server_10'\n\n    @allure.severity('blocker')\n    @allure.feature('视频管理')\n    @allure.story('添加视频')\n    @allure.title('添加PVG视频服务器成功')\n    @pytest.mark.parametrize('pvg_server', ['pvg_server_67', 'pvg_server_10'], ids=['1-pvg67', '2-pvg10'])\n    def test_2101_add_pvg(video_api, pvg_server):\n        # 添加\n        video_api.save_video(pvg_server)\n>       video_api.assert_server_count()\n\ntestAPI\\interface\\mod_2_video\\test_21_save_video.py:14: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <testAPI.interface.mod_2_video.conftest.APIVideo object at 0x000002549F15F748>\n\n    @allure.step('ast - 1. 断言VideoServer资源数量')\n    def assert_server_count(self):\n        # 通过数据库确认camera数量\n        query_camera_count = \"SELECT COUNT(*) FROM t_video_channel \" \\\n                             \"WHERE F_Video_Server_ID = '{}' \" \\\n                             \"AND F_Enabled = 1;\".format(self.server_id)\n        # logger.debug(query_camera_count)\n    \n        # 循环检查并断言camera数量\n        init = -1\n        start = datetime.datetime.now()\n        while True:\n            count = Sql().query(query_camera_count)[0][0]\n            now = datetime.datetime.now()\n            interval = (now - start).seconds\n            if count == self.video_conf['real_count']:\n                logger.info('查询完毕，结果{}匹配'.format(count))\n                res = 'SUCCESS'\n                break\n            elif count == init and interval > 30:\n                logger.error('查询完毕，结果不匹配')\n                res = 'FAIL'\n                break\n            else:\n                init = count\n                logger.info('查询中，已耗时{}，已同步{}条'.format((now - start), count))\n                time.sleep(5)\n        end = datetime.datetime.now()\n        logger.info('总耗时:{}'.format(end - start))\n>       assert res == 'SUCCESS'\nE       AssertionError: assert 'FAIL' == 'SUCCESS'\nE         - FAIL\nE         + SUCCESS\n\ntestAPI\\interface\\mod_2_video\\conftest.py:132: AssertionError"}, "steps": [{"name": "ext - 0. 添加视频 <添加pvg/rtsp视频> ", "status": "passed", "steps": [{"name": "api - 1. 添加PvgServer", "status": "passed", "parameters": [{"name": "pvg_json", "value": "{'name': '10.0.100.119', 'ipAddress': '10.0.100.119', 'version': 'PVG10_1', 'port': 2015, 'description': '', 'ext': '{\"uid\":\"admin\",\"pwd\":\"123456\"}', 'real_count': 10278}"}, {"name": "status", "value": "'PASS'"}], "start": 1548930193013, "stop": 1548930193033}, {"name": "ext - 1. 获取视频服务ID ", "status": "passed", "parameters": [{"name": "video_conf", "value": "{'name': '10.0.100.119', 'ipAddress': '10.0.100.119', 'version': 'PVG10_1', 'port': 2015, 'description': '', 'ext': '{\"uid\":\"admin\",\"pwd\":\"123456\"}', 'real_count': 10278}"}], "start": 1548930193033, "stop": 1548930193051}], "parameters": [{"name": "video_server", "value": "'pvg_server_10'"}, {"name": "index", "value": "0"}, {"name": "status", "value": "'PASS'"}], "start": 1548930192999, "stop": 1548930193051}, {"name": "ast - 1. 断言VideoServer资源数量", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'FAIL' == 'SUCCESS'\n  - FAIL\n  + SUCCESS\n", "trace": "  File \"c:\\users\\sensenets\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\allure_commons\\_allure.py\", line 141, in impl\n    return func(*a, **kw)\n  File \"E:\\Python\\test_framework\\testAPI\\interface\\mod_2_video\\conftest.py\", line 132, in assert_server_count\n    assert res == 'SUCCESS'\n"}, "start": 1548930193051, "stop": 1548930228310}], "attachments": [{"name": "log", "source": "07a68bac-1cc5-4846-adbf-b9e1176005d6-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "76a727fd-4fe6-4eff-b5b2-34e8d4108312-attachment.txt", "type": "text/plain"}, {"name": "stderr", "source": "a51e4799-e3ad-4193-b474-a39a7dc04be9-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "pvg_server", "value": "'pvg_server_10'"}], "start": 1548930192999, "stop": 1548930228313, "uuid": "07ed9d3b-1d43-43a0-9aa9-919433ba1784", "historyId": "d8806695ef4b0b8a4f5a68adfb25f855", "fullName": "testAPI.interface.mod_2_video.test_21_save_video#test_2101_add_pvg[2-pvg10]", "labels": [{"name": "feature", "value": "视频管理"}, {"name": "severity", "value": "blocker"}, {"name": "story", "value": "添加视频"}, {"name": "parentSuite", "value": "testAPI.interface.mod_2_video"}, {"name": "suite", "value": "test_21_save_video"}, {"name": "host", "value": "WINDOWS-85GBJ6H"}, {"name": "thread", "value": "29916-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testAPI.interface.mod_2_video.test_21_save_video"}]}