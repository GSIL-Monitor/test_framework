{"name": "test_2203_refresh_pvg[1-pvg67]", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'FAIL' == 'SUCCESS'\n  - FAIL\n  + SUCCESS", "trace": "video_env = <function video_env.<locals>.parse_env_video at 0x000001B5FA025730>\npvg_server = 'pvg_server_67'\n\n    @allure.severity('critical')\n    @allure.feature('视频管理')\n    @allure.story('同步pvg视频服务器')\n    @pytest.mark.parametrize('pvg_server', ['pvg_server_67', 'pvg_server_10'], ids=['1-pvg67', '2-pvg10'])\n    def test_2203_refresh_pvg(video_env, pvg_server):\n        my_video = video_env(pvg_server)\n        my_video.refresh_pvg_server()\n>       my_video.assert_server_count()\n\ntestAPI\\interface\\mod_2_video\\test_22_modify_video.py:31: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <testAPI.interface.mod_2_video.conftest.APIVideo object at 0x000001B5FA095CF8>\n\n    @allure.step('ast - 1. 断言VideoServer资源数量')\n    def assert_server_count(self):\n        # 通过数据库确认camera数量\n        query_camera_count = \"SELECT COUNT(*) FROM t_video_channel \" \\\n                             \"WHERE F_Video_Server_ID = '{}' \" \\\n                             \"AND F_Enabled = 1;\".format(self.server_id)\n        # logger.debug(query_camera_count)\n    \n        # 循环检查并断言camera数量\n        init = -1\n        start = datetime.datetime.now()\n        while True:\n            count = Sql().query(query_camera_count)[0][0]\n            now = datetime.datetime.now()\n            interval = (now - start).seconds\n            if count == self.video_conf['real_count']:\n                logger.info('查询完毕，结果{}匹配'.format(count))\n                res = 'SUCCESS'\n                break\n            elif count == init and interval > 30:\n                logger.error('查询完毕，结果不匹配')\n                res = 'FAIL'\n                break\n            else:\n                init = count\n                logger.info('查询中，已耗时{}，已同步{}条'.format((now - start), count))\n                time.sleep(5)\n        end = datetime.datetime.now()\n        logger.info('总耗时:{}'.format(end - start))\n>       assert res == 'SUCCESS'\nE       AssertionError: assert 'FAIL' == 'SUCCESS'\nE         - FAIL\nE         + SUCCESS\n\ntestAPI\\interface\\mod_2_video\\conftest.py:133: AssertionError"}, "steps": [{"name": "ext - 1. 获取视频服务ID ", "status": "passed", "start": 1548846554411, "stop": 1548846554427}, {"name": "api - 2. 同步PvgServer", "status": "passed", "parameters": [{"name": "status", "value": "'PASS'"}], "start": 1548846554427, "stop": 1548846554442}, {"name": "ast - 1. 断言VideoServer资源数量", "status": "failed", "statusDetails": {"message": "AssertionError: assert 'FAIL' == 'SUCCESS'\n  - FAIL\n  + SUCCESS\n", "trace": "  File \"c:\\users\\sensenets\\appdata\\local\\programs\\python\\python36\\lib\\site-packages\\allure_commons\\_allure.py\", line 141, in impl\n    return func(*a, **kw)\n  File \"E:\\Python\\test_framework\\testAPI\\interface\\mod_2_video\\conftest.py\", line 133, in assert_server_count\n    assert res == 'SUCCESS'\n"}, "start": 1548846554442, "stop": 1548846589641}], "attachments": [{"name": "log", "source": "b4d00f90-98ee-4d81-9d02-919e08fa0be6-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "6bc49e5a-c171-471e-ba39-607a3c2b70a1-attachment.txt", "type": "text/plain"}, {"name": "stderr", "source": "8a37f2a6-6465-4924-8ece-1cff16c3c7a9-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "pvg_server", "value": "'pvg_server_67'"}], "start": 1548846554396, "stop": 1548846589662, "uuid": "35610631-27de-46fb-8e93-1710d34fd98c", "historyId": "5d7cac70c8887ea29843df3e332a068c", "fullName": "testAPI.interface.mod_2_video.test_22_modify_video#test_2203_refresh_pvg[1-pvg67]", "labels": [{"name": "severity", "value": "critical"}, {"name": "story", "value": "同步pvg视频服务器"}, {"name": "feature", "value": "视频管理"}, {"name": "parentSuite", "value": "testAPI.interface.mod_2_video"}, {"name": "suite", "value": "test_22_modify_video"}, {"name": "host", "value": "WINDOWS-85GBJ6H"}, {"name": "thread", "value": "7716-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testAPI.interface.mod_2_video.test_22_modify_video"}]}